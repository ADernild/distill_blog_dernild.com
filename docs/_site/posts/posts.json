[
  {
    "path": "posts/2020-12-02-collecting-and-preparing-tweets-for-a-nlp-project/",
    "title": "Collecting and preparing Tweets for a NLP project",
    "description": "As a part of a Natural Language Processing project, focused on the US presidential debates and election 2020, I collected a total amount of 325.314 unique tweets. In this post, I will explain how I managed to do this, utilizing Twitter's API and R Studio.",
    "author": [
      {
        "name": "Alexander Dernild",
        "url": "https://github.com/ADernild"
      }
    ],
    "date": "2020-12-02",
    "categories": [
      "Twitter Data",
      "NLP",
      "pres_debate"
    ],
    "contents": "\n\nContents\nTwitter’s API platform\nTwitter Developer Portal - Setting up an application\nConnecting R to the Twitter API\nCollecting Tweets\n\nCleaning text variable in Twitter Data\nProgrammatically cleaning Twitter data\nJoining multiple Twitter queries\n\n\nTwitter’s API platform\n\nTwitter is built on the robust conversations happening around the world via Tweets. With Twitter’s API platform, you’ll find endpoints to capitalize on the functionality and data contained within Tweets, and to build great experiences and solutions for your customers. These endpoints enable you to manage your Tweets, publish and curate Tweets, filter and search for Tweet topics or trends, and much more (Twitter, 2020).\n\nThe first step, in order to collect tweets, is to acquire an API key for Twitter’s Rest API. This is done by applying for one at Twitter’s developer portal1, luckily for me this process was very brief, and I got my API key within a day.\nTwitter Developer Portal - Setting up an application\nHaving access to Twitter Developers Portal and API, enabled me to set up an application, which could then be used, to connect my R environment with Twitter’s API. This would allow me to manipulate the API using R, i.e., searching for Tweet topics or trends at specified time frames.\nFigure 1.1 Configuring application on Twitter Developer Portal\nNote: It’s important, when configuring an application, to set a callback URL to 127.0.0.1:1410. This allows rtweet package to authenticate with your Twitter account.\nConnecting R to the Twitter API\nTo connect R to the newly created application, an acccess token has to be created, using the application’s API key and secret. I used the create_token() function from rtweet package (Kearney, 2019) to do this, configuring it as follows:\nlibrary(rtweet)\n\nkey <- 'XXXXXXXXXXXXXXXXX' #this is not a key\nsecret <- 'XXXXXXXXXXXXXXXXXX'\n     \n# Connecting to Twitter API\ntwitter_token <- create_token(\n app = \"presidentialdebate\",\n consumer_key = key,\n consumer_secret = secret\n)\nUsing create_token() from the rtweet package, saves this token as a variable in .Renviron, allowing one to use Twitter’s API without configuring a new token every session.\nCollecting Tweets\nHaving set up an access token, Twitter’s API can now be manipulated through R, using the rtweet package (Kearney, 2019). To collect Tweets already sent, Tweets can be searched using the search_tweets() function, with the main parameters being q (search query) and n (number of desired tweets). As I wanted to perform multiple queries/searches with different search queries, number of tweets and time frames, around both the first and final presidential debate, I decided to create a .csv file (twitter_data.csv), where each row contains the specifications of a query/search.\nColumns in twitter_data.csv\nsince (date from which collection should begin)\nuntil (date at which collection should cease)\nn (number of tweets to collect)\ntype (Search type recent/mixed/popular)\nterm (Search term)\npath (path to save data)\naltpath (path to save data when cleaned)\n\n\n\n{\"columns\":[{\"label\":[\"since\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"until\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"n\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"type\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"term\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"path\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"altpath\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"2020-09-30\",\"2\":\"2020-10-01\",\"3\":\"36000\",\"4\":\"recent\",\"5\":\"presidentialdebate\",\"6\":\"data_backup/tweets/first/24_hour/recent/pres_debate.rds\",\"7\":\"data_backup/tweets/first/24_hour/recent/pres_debate_clean.rds\"},{\"1\":\"2020-09-30\",\"2\":\"2020-10-01\",\"3\":\"18000\",\"4\":\"recent\",\"5\":\"trump\",\"6\":\"data_backup/tweets/first/24_hour/recent/trump.rds\",\"7\":\"data_backup/tweets/first/24_hour/recent/trump_clean.rds\"},{\"1\":\"2020-09-30\",\"2\":\"2020-10-01\",\"3\":\"18000\",\"4\":\"recent\",\"5\":\"biden\",\"6\":\"data_backup/tweets/first/24_hour/recent/biden.rds\",\"7\":\"data_backup/tweets/first/24_hour/recent/biden_clean.rds\"},{\"1\":\"2020-09-30\",\"2\":\"2020-10-01\",\"3\":\"36000\",\"4\":\"mixed\",\"5\":\"presidentialdebate\",\"6\":\"data_backup/tweets/first/24_hour/mixed/pres_debate.rds\",\"7\":\"data_backup/tweets/first/24_hour/mixed/pres_debate_clean.rds\"},{\"1\":\"2020-09-30\",\"2\":\"2020-10-01\",\"3\":\"18000\",\"4\":\"mixed\",\"5\":\"trump\",\"6\":\"data_backup/tweets/first/24_hour/mixed/trump.rds\",\"7\":\"data_backup/tweets/first/24_hour/mixed/trump_clean.rds\"},{\"1\":\"2020-09-30\",\"2\":\"2020-10-01\",\"3\":\"18000\",\"4\":\"mixed\",\"5\":\"biden\",\"6\":\"data_backup/tweets/first/24_hour/mixed/biden.rds\",\"7\":\"data_backup/tweets/first/24_hour/mixed/biden_clean.rds\"},{\"1\":\"2020-09-30\",\"2\":\"2020-10-01\",\"3\":\"36000\",\"4\":\"popular\",\"5\":\"presidentialdebate\",\"6\":\"data_backup/tweets/first/24_hour/popular/pres_debate.rds\",\"7\":\"data_backup/tweets/first/24_hour/popular/pres_debate_clean.rds\"},{\"1\":\"2020-09-30\",\"2\":\"2020-10-01\",\"3\":\"18000\",\"4\":\"popular\",\"5\":\"trump\",\"6\":\"data_backup/tweets/first/24_hour/popular/trump.rds\",\"7\":\"data_backup/tweets/first/24_hour/popular/trump_clean.rds\"},{\"1\":\"2020-09-30\",\"2\":\"2020-10-01\",\"3\":\"18000\",\"4\":\"popular\",\"5\":\"biden\",\"6\":\"data_backup/tweets/first/24_hour/popular/biden.rds\",\"7\":\"data_backup/tweets/first/24_hour/popular/biden_clean.rds\"},{\"1\":\"2020-09-27\",\"2\":\"2020-10-04\",\"3\":\"36000\",\"4\":\"recent\",\"5\":\"presidentialdebate\",\"6\":\"data_backup/tweets/first/7_day/recent/pres_debate.rds\",\"7\":\"data_backup/tweets/first/7_day/recent/pres_debate_clean.rds\"},{\"1\":\"2020-09-27\",\"2\":\"2020-10-04\",\"3\":\"18000\",\"4\":\"recent\",\"5\":\"trump\",\"6\":\"data_backup/tweets/first/7_day/recent/trump.rds\",\"7\":\"data_backup/tweets/first/7_day/recent/trump_clean.rds\"},{\"1\":\"2020-09-27\",\"2\":\"2020-10-04\",\"3\":\"18000\",\"4\":\"recent\",\"5\":\"biden\",\"6\":\"data_backup/tweets/first/7_day/recent/biden.rds\",\"7\":\"data_backup/tweets/first/7_day/recent/biden_clean.rds\"},{\"1\":\"2020-09-27\",\"2\":\"2020-10-04\",\"3\":\"36000\",\"4\":\"mixed\",\"5\":\"presidentialdebate\",\"6\":\"data_backup/tweets/first/7_day/mixed/pres_debate.rds\",\"7\":\"data_backup/tweets/first/7_day/mixed/pres_debate_clean.rds\"},{\"1\":\"2020-09-27\",\"2\":\"2020-10-04\",\"3\":\"18000\",\"4\":\"mixed\",\"5\":\"trump\",\"6\":\"data_backup/tweets/first/7_day/mixed/trump.rds\",\"7\":\"data_backup/tweets/first/7_day/mixed/trump_clean.rds\"},{\"1\":\"2020-09-27\",\"2\":\"2020-10-04\",\"3\":\"18000\",\"4\":\"mixed\",\"5\":\"biden\",\"6\":\"data_backup/tweets/first/7_day/mixed/biden.rds\",\"7\":\"data_backup/tweets/first/7_day/mixed/biden_clean.rds\"},{\"1\":\"2020-09-27\",\"2\":\"2020-10-04\",\"3\":\"36000\",\"4\":\"popular\",\"5\":\"presidentialdebate\",\"6\":\"data_backup/tweets/first/7_day/popular/pres_debate.rds\",\"7\":\"data_backup/tweets/first/7_day/popular/pres_debate_clean.rds\"},{\"1\":\"2020-09-27\",\"2\":\"2020-10-04\",\"3\":\"18000\",\"4\":\"popular\",\"5\":\"trump\",\"6\":\"data_backup/tweets/first/7_day/popular/trump.rds\",\"7\":\"data_backup/tweets/first/7_day/popular/trump_clean.rds\"},{\"1\":\"2020-09-27\",\"2\":\"2020-10-04\",\"3\":\"18000\",\"4\":\"popular\",\"5\":\"biden\",\"6\":\"data_backup/tweets/first/7_day/popular/biden.rds\",\"7\":\"data_backup/tweets/first/7_day/popular/biden_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-24\",\"3\":\"36000\",\"4\":\"recent\",\"5\":\"presidentialdebate\",\"6\":\"data_backup/tweets/final/24_hour/recent/pres_debate.rds\",\"7\":\"data_backup/tweets/final/24_hour/recent/pres_debate_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-24\",\"3\":\"18000\",\"4\":\"recent\",\"5\":\"trump\",\"6\":\"data_backup/tweets/final/24_hour/recent/trump.rds\",\"7\":\"data_backup/tweets/final/24_hour/recent/trump_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-24\",\"3\":\"18000\",\"4\":\"recent\",\"5\":\"biden\",\"6\":\"data_backup/tweets/final/24_hour/recent/biden.rds\",\"7\":\"data_backup/tweets/final/24_hour/recent/biden_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-24\",\"3\":\"36000\",\"4\":\"mixed\",\"5\":\"presidentialdebate\",\"6\":\"data_backup/tweets/final/24_hour/mixed/pres_debate.rds\",\"7\":\"data_backup/tweets/final/24_hour/mixed/pres_debate_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-24\",\"3\":\"18000\",\"4\":\"mixed\",\"5\":\"trump\",\"6\":\"data_backup/tweets/final/24_hour/mixed/trump.rds\",\"7\":\"data_backup/tweets/final/24_hour/mixed/trump_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-24\",\"3\":\"18000\",\"4\":\"mixed\",\"5\":\"biden\",\"6\":\"data_backup/tweets/final/24_hour/mixed/biden.rds\",\"7\":\"data_backup/tweets/final/24_hour/mixed/biden_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-24\",\"3\":\"36000\",\"4\":\"popular\",\"5\":\"presidentialdebate\",\"6\":\"data_backup/tweets/final/24_hour/popular/pres_debate.rds\",\"7\":\"data_backup/tweets/final/24_hour/popular/pres_debate_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-24\",\"3\":\"18000\",\"4\":\"popular\",\"5\":\"trump\",\"6\":\"data_backup/tweets/final/24_hour/popular/trump.rds\",\"7\":\"data_backup/tweets/final/24_hour/popular/trump_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-24\",\"3\":\"18000\",\"4\":\"popular\",\"5\":\"biden\",\"6\":\"data_backup/tweets/final/24_hour/popular/biden.rds\",\"7\":\"data_backup/tweets/final/24_hour/popular/biden_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-24\",\"3\":\"36000\",\"4\":\"recent\",\"5\":\"debate2020\",\"6\":\"data_backup/tweets/final/24_hour/recent/debate.rds\",\"7\":\"data_backup/tweets/final/24_hour/recent/debate_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-24\",\"3\":\"36000\",\"4\":\"mixed\",\"5\":\"debate2020\",\"6\":\"data_backup/tweets/final/24_hour/mixed/debate.rds\",\"7\":\"data_backup/tweets/final/24_hour/mixed/debate_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-24\",\"3\":\"36000\",\"4\":\"popular\",\"5\":\"debate2020\",\"6\":\"data_backup/tweets/final/24_hour/popular/debate.rds\",\"7\":\"data_backup/tweets/final/24_hour/popular/debate_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"36000\",\"4\":\"recent\",\"5\":\"presidentialdebate\",\"6\":\"data_backup/tweets/final/7_day/recent/pres_debate.rds\",\"7\":\"data_backup/tweets/final/7_day/recent/pres_debate_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"18000\",\"4\":\"recent\",\"5\":\"trump\",\"6\":\"data_backup/tweets/final/7_day/recent/trump.rds\",\"7\":\"data_backup/tweets/final/7_day/recent/trump_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"18000\",\"4\":\"recent\",\"5\":\"biden\",\"6\":\"data_backup/tweets/final/7_day/recent/biden.rds\",\"7\":\"data_backup/tweets/final/7_day/recent/biden_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"36000\",\"4\":\"mixed\",\"5\":\"presidentialdebate\",\"6\":\"data_backup/tweets/final/7_day/mixed/pres_debate.rds\",\"7\":\"data_backup/tweets/final/7_day/mixed/pres_debate_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"18000\",\"4\":\"mixed\",\"5\":\"trump\",\"6\":\"data_backup/tweets/final/7_day/mixed/trump.rds\",\"7\":\"data_backup/tweets/final/7_day/mixed/trump_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"18000\",\"4\":\"mixed\",\"5\":\"biden\",\"6\":\"data_backup/tweets/final/7_day/mixed/biden.rds\",\"7\":\"data_backup/tweets/final/7_day/mixed/biden_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"36000\",\"4\":\"popular\",\"5\":\"presidentialdebate\",\"6\":\"data_backup/tweets/final/7_day/popular/pres_debate.rds\",\"7\":\"data_backup/tweets/final/7_day/popular/pres_debate_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"18000\",\"4\":\"popular\",\"5\":\"trump\",\"6\":\"data_backup/tweets/final/7_day/popular/trump.rds\",\"7\":\"data_backup/tweets/final/7_day/popular/trump_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"18000\",\"4\":\"popular\",\"5\":\"biden\",\"6\":\"data_backup/tweets/final/7_day/popular/biden.rds\",\"7\":\"data_backup/tweets/final/7_day/popular/biden_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"36000\",\"4\":\"recent\",\"5\":\"debate2020\",\"6\":\"data_backup/tweets/final/7_day/recent/debate.rds\",\"7\":\"data_backup/tweets/final/7_day/recent/debate_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"36000\",\"4\":\"mixed\",\"5\":\"debate2020\",\"6\":\"data_backup/tweets/final/7_day/mixed/debate.rds\",\"7\":\"data_backup/tweets/final/7_day/mixed/debate_clean.rds\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"36000\",\"4\":\"popular\",\"5\":\"debate2020\",\"6\":\"data_backup/tweets/final/7_day/popular/debate.rds\",\"7\":\"data_backup/tweets/final/7_day/popular/debate_clean.rds\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[4]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  \n\nBy doing this, I won’t have to hard program all these different search specifications, into separate function calls, but can instead programatically pass each row to a search_tweets() call. This could be done by looping through the rows of twitter_data.csv, passing the specified parameters to search_tweets(), and saving the resulting data.frame as a RData (.rds) file at each iteration. For this purpose I wrapped search_tweets() along with saveRDS() to save the queries as .rds files, in a new function I named twitter_grab():\ntwitter_grab <- function(term, n, since, until, type, file) {\n  tweets <- search_tweets(q = term,\n                          n = n,\n                          include_rts = FALSE,\n                          lang = \"en\",\n                          since = since,\n                          until = until,\n                          type = type,\n                          retryonratelimit = TRUE\n  )\n  \n  saveRDS(tweets, file = file)\n  cat(file, \"saved\")\n}\nAs the Twitter API is limited, to only return tweets sent during the past 7 days, I had to collect the data on multiple occasions. First collecting tweets immediately after the first debate, then 7 days after and doing the same for the final debate. There are probably more elegant ways of doing this e.g., Cron jobs, but I decided to call the loop manually on multiple occasions, specifying, when calling the loop, which rows to query at each occasion.\n# Grabbing tweets programmatically using a .csv file\nref <- read.csv('twitter_data.csv', stringsAsFactors = FALSE) #.csv file containing paths and search specs\n\n# Looping throug data.frame ref calling twitter_grab() function\nfor (row in 31:nrow(ref)) {\n  twitter_grab(\n    ref$term[row],\n    ref$n[row],\n    ref$since[row],\n    ref$until[row],\n    ref$type[row],\n    ref$path[row]\n  )\n}\nThe above loop being the last I used collect Tweets sent during the week following the final Presidential debate. This loop iterates over the following subset of twitter_data.csv, and pass the search specifications to my function twitter_grab().\n\n\n\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"since\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"until\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"n\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"type\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"term\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"path\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"altpath\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"36000\",\"4\":\"recent\",\"5\":\"presidentialdebate\",\"6\":\"data_backup/tweets/final/7_day/recent/pres_debate.rds\",\"7\":\"data_backup/tweets/final/7_day/recent/pres_debate_clean.rds\",\"_rn_\":\"31\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"18000\",\"4\":\"recent\",\"5\":\"trump\",\"6\":\"data_backup/tweets/final/7_day/recent/trump.rds\",\"7\":\"data_backup/tweets/final/7_day/recent/trump_clean.rds\",\"_rn_\":\"32\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"18000\",\"4\":\"recent\",\"5\":\"biden\",\"6\":\"data_backup/tweets/final/7_day/recent/biden.rds\",\"7\":\"data_backup/tweets/final/7_day/recent/biden_clean.rds\",\"_rn_\":\"33\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"36000\",\"4\":\"mixed\",\"5\":\"presidentialdebate\",\"6\":\"data_backup/tweets/final/7_day/mixed/pres_debate.rds\",\"7\":\"data_backup/tweets/final/7_day/mixed/pres_debate_clean.rds\",\"_rn_\":\"34\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"18000\",\"4\":\"mixed\",\"5\":\"trump\",\"6\":\"data_backup/tweets/final/7_day/mixed/trump.rds\",\"7\":\"data_backup/tweets/final/7_day/mixed/trump_clean.rds\",\"_rn_\":\"35\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"18000\",\"4\":\"mixed\",\"5\":\"biden\",\"6\":\"data_backup/tweets/final/7_day/mixed/biden.rds\",\"7\":\"data_backup/tweets/final/7_day/mixed/biden_clean.rds\",\"_rn_\":\"36\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"36000\",\"4\":\"popular\",\"5\":\"presidentialdebate\",\"6\":\"data_backup/tweets/final/7_day/popular/pres_debate.rds\",\"7\":\"data_backup/tweets/final/7_day/popular/pres_debate_clean.rds\",\"_rn_\":\"37\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"18000\",\"4\":\"popular\",\"5\":\"trump\",\"6\":\"data_backup/tweets/final/7_day/popular/trump.rds\",\"7\":\"data_backup/tweets/final/7_day/popular/trump_clean.rds\",\"_rn_\":\"38\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"18000\",\"4\":\"popular\",\"5\":\"biden\",\"6\":\"data_backup/tweets/final/7_day/popular/biden.rds\",\"7\":\"data_backup/tweets/final/7_day/popular/biden_clean.rds\",\"_rn_\":\"39\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"36000\",\"4\":\"recent\",\"5\":\"debate2020\",\"6\":\"data_backup/tweets/final/7_day/recent/debate.rds\",\"7\":\"data_backup/tweets/final/7_day/recent/debate_clean.rds\",\"_rn_\":\"40\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"36000\",\"4\":\"mixed\",\"5\":\"debate2020\",\"6\":\"data_backup/tweets/final/7_day/mixed/debate.rds\",\"7\":\"data_backup/tweets/final/7_day/mixed/debate_clean.rds\",\"_rn_\":\"41\"},{\"1\":\"2020-10-23\",\"2\":\"2020-10-30\",\"3\":\"36000\",\"4\":\"popular\",\"5\":\"debate2020\",\"6\":\"data_backup/tweets/final/7_day/popular/debate.rds\",\"7\":\"data_backup/tweets/final/7_day/popular/debate_clean.rds\",\"_rn_\":\"42\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[4]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  \n\nIn total the Twitter data collection resulted in 42 queries (one for each row in twitter_data.csv), which was then saved as 42 individual RData (.rds) files.\nCleaning text variable in Twitter Data\nNow that I have collected the Tweets, in order to use this data in a Natural Language Processing project, the text variable needs to be cleaned, i.e., removing links, mentions, hashtags and other special characters. To do this, I found some different examples on StackOverflow, using reprex to clean Tweets and modified this into a function:\nlibrary(tidyverse)\nlibrary(data.table)\n\n# Cleaning function modified from StackOverflow \nclean_tweets <- function(x) {\n  x %>%\n    str_remove_all(\" ?(f|ht)(tp)(s?)(://)(.*)[.|/](.*)\") %>% #removes links\n    str_replace_all(\"&amp;\", \"and\") %>%  #replaces &amp; with and\n    str_remove_all(\"^RT:? \") %>% #removes retweets\n    str_remove_all(\"@[[:alnum:]]*\") %>% #removes mentions\n    str_remove_all(\"#[[:alnum:]]*\") %>% #removes hashtags\n    str_remove_all(\"(?![.,])[[:punct:]]\") %>% #removes punctuation except . and ,\n    str_replace_all(\"\\\\\\n\", \" \") %>% \n    str_to_lower() %>% # Converts to lower case\n    str_trim(\"both\") # Removes whitespace on both sides of string\n}\nProgrammatically cleaning Twitter data\nHaving a function that can clean the text variable of the Twitter data, I now need to load in the 42 .rds files, clean the text variable, and save 42 new .rds files keeping a backup of the raw data. To do this I will again use twitter_data.csv, first to read in the aforementioned data files, but also to save the cleaned data using the altpath column. Furthermore, Twitter data contains many variables (around 90) and as I’m only interested in looking at a few of these, and also have a backup of the raw data, I will select the variables of interest and retain these in the new data files. To do this I initialize a the R object voi containing the names of the variables to keep.\n# Cleaning tweets programmatically\nref <- read.csv('twitter_data.csv', stringsAsFactors = FALSE) # .csv file containing path and altpath\n\nvoi <- c('user_id', 'status_id', 'created_at',\n         'text', 'hashtags', 'location',\n         'retweet_count', 'favorite_count', 'followers_count') # Variables of interest\nMuch like when collecting the Tweets I now loop through twitter_data.csv, loading each file using the path column and selecting the variables of interest or voi. Then the text variable of each file, is being passed to my function clean_tweets() before saving the data.frame as a new .rds file using the column altpath in twitter_data.csv.\n# Looping through ref reading in datasets containing tweets and cleaning text variable\nfor (row in 1:nrow(ref)) {\n  df <- readRDS(ref$path[row]) %>% \n    select(all_of(voi))\n  df$text <- clean_tweets(df$text)\n  saveRDS(df, ref$altpath[row])\n}\nHaving an individual file for each query is nice for backup purposes, however, for analysis purposes, loading 42 individual files and applying the same operations on each doesn’t seem effective. Therefore, in this next section I will join the files together, to create two distinct data.frames during and after the first and final debate.\nJoining multiple Twitter queries\nIn order to join the files together I need to load in the newly created clean .rds files. I do this by creating a list of data.frames and calling it df_list. I then use the function rbindlist, to bind the rows from the files pertaining to the first debate together, and remove duplicates using the function distinct on the variable status_id. The resulting data.frame is then saved as a new .rds file, and the same is done for the files pertaining to the final debate.\n# Loading cleaned datasets as list of dataframes\ndf_list <- lapply(ref$altpath, readRDS)\nref_clean <- read.csv('twitter_data_clean.csv', stringsAsFactors = FALSE) # .csv file containing paths for cleaned data\n\n# Combining cleaned datasets into two dataframes with regard to collection date\npresdebate_first <- rbindlist(df_list[1:18]) %>% \n  distinct(status_id, .keep_all = TRUE) %>% \n  saveRDS(ref_clean$path[1])\n\npresdebate_final <- rbindlist(df_list[19:39]) %>% \n  distinct(status_id, .keep_all = TRUE) %>% \n  saveRDS(ref_clean$path[2])\nThis resulted in two RData .rds files containing a total of 325.314 unique tweets, which are now ready for analysis. If you are interested in checking out this project in more depth, the complete source code can be found on GitHub.\n\n\n\nKearney, M. W. (2019). Rtweet: Collecting and analyzing twitter data. Journal of Open Source Software, 4(42), 1829. https://doi.org/10.21105/joss.01829\n\n\nTwitter. (2020). Publish and manage Tweets, and analyze Tweet data. https://developer.twitter.com/en/use-cases\n\n\nTwitter grants API keys based on use case and application, documentation, terms and application form can be found here↩︎\n",
    "preview": "posts/2020-12-02-collecting-and-preparing-tweets-for-a-nlp-project/../../src/images/collecting_tweets_preview.png",
    "last_modified": "2020-12-03T03:30:52+01:00",
    "input_file": {},
    "preview_width": 780,
    "preview_height": 460
  }
]
